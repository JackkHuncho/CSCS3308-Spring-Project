<div class="container mt-4">
    <h2 class="text-white animate__animated animate__bounce ">Settings</h2>
    <form action="/settings" method="POST" enctype="multipart/form-data">
        
        <div class="mb-3">
            <label for="username" class="form-label">Change Username</label>
            <input type="text" class="form-control" id="username" name="username" value="{{user.username}}" required>
        </div>
        
        <div class="mb-3">
            <label for="password" class="form-label">Change Password</label>
            <input type="text" class="form-control" id="password" name="password" required>
        </div>

        <div class="mb-3">
            <label for="pfp" class="form-label">Update Profile Picture</label>
            <input type="file" class="form-control" id="pfp" name="pfp" accept="image/*">
        </div>
        
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>




    <div class="mt-3">
    <button id="connectAppleBtn" class="btn btn-danger btn-animated">Connect with Apple Music</button>
  </div>

  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const res = await fetch("/apple-token");
      const { token: devToken } = await res.json();

      MusicKit.configure({
        developerToken: devToken,
        app: {
          name: "CrossTune",
          build: "1.0"
        }
      });

      const music = MusicKit.getInstance();

      document.getElementById("connectAppleBtn").addEventListener("click", async () => {
        try {
          const userToken = await music.authorize();

          await fetch("/apple-user-token", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ userToken })
          });

          alert("Apple Music connected!");
          window.location.reload();
        } catch (err) {
          console.error("Apple Music connection failed:", err);
        }
      });
    });
  </script>

<!-- Connect Spotify -->
  <div class="mt-3">
    <a
      href="/connect-spotify"
      class="btn btn-success btn-animated"
      style="text-decoration: none;"
    >Connect with Spotify</a>
  </div>


</div>